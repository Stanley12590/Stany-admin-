<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STANY MIN ADMIN - ULTIMATE CONTROL</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #FF0000;
            --bg: #000000;
            --card: #0a0a0a;
            --border: #1a1a1a;
            --text: #ffffff;
            --gray: #888;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; outline: none; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .nav-item { padding: 12px 15px; border-radius: 15px; cursor: pointer; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; color: #888; transition: 0.3s; font-size: 0.9em; font-weight: 600; }
        .nav-item:hover, .nav-item.active { background: var(--primary); color: #fff; }

        /* MAIN AREA */
        .main { flex: 1; overflow-y: auto; padding: 30px; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        .section { display: none; }
        .section.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* FORMS */
        .app-card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 25px; margin-bottom: 25px; }
        .input-box, .select-modern { width: 100%; padding: 14px; background: #000; border: 1px solid #222; color: white; border-radius: 15px; margin-bottom: 15px; font-size: 0.9em; }
        .btn { padding: 12px 25px; border-radius: 18px; border: none; font-weight: 800; cursor: pointer; background: var(--primary); color: #fff; transition: 0.3s; }
        .btn-d { background: #222; }

        /* CHAT */
        .chat-list { max-height: 400px; overflow-y: auto; }
        .chat-item { padding: 15px; background: #050505; border: 1px solid #111; border-radius: 18px; margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; }
        .unread-badge { background: var(--primary); color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px; }

        .ep-row { background: #000; padding: 15px; border-radius: 15px; border-left: 4px solid var(--primary); margin-bottom: 10px; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 10px 30px; border-radius: 30px; z-index: 5000; display: none; font-weight: 800; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>
<body>

    <!-- AUTH OVERLAY -->
    <div id="authOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; display:flex; justify-content:center; align-items:center;">
        <div class="app-card" style="width:350px; text-align:center;">
            <h2 style="color:var(--primary); margin-bottom:20px; font-family: 'Orbitron';">ADMIN LOGIN</h2>
            <input type="email" id="adminEmail" class="input-box" placeholder="Admin Email">
            <input type="password" id="adminPass" class="input-box" placeholder="Password">
            <button class="btn" style="width: 100%;" onclick="login()">ENTER PANEL</button>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h1 style="color:var(--primary); font-family:'Orbitron'; font-size:20px; margin-bottom:30px;">STANY ADMIN</h1>
        <div class="nav-item active" onclick="showSection('ads')"><i class="fas fa-ad"></i>Ads Pool</div>
        <div class="nav-item" onclick="showSection('tokens')"><i class="fas fa-key"></i>Token Factory</div>
        <div class="nav-item" onclick="showSection('library')"><i class="fas fa-book"></i>Library/Episodes</div>
        <div class="nav-item" onclick="showSection('content')"><i class="fas fa-film"></i>Movies & Adult</div>
        <div class="nav-item" onclick="showSection('chat')"><i class="fas fa-comments"></i>Support & Group</div>
        <div class="nav-item" onclick="showSection('users')"><i class="fas fa-users-cog"></i>User HWID & Pass</div>
        <div class="nav-item" style="margin-top:auto; color:red" onclick="auth.signOut()"><i class="fas fa-power-off"></i>Logout</div>
    </div>

    <div class="main">
        
        <!-- 1. ADS POOL MANAGER -->
        <div id="ads" class="section active">
            <h2>Ultimate Ads Pool</h2>
            <div class="app-card">
                <select id="ad-type" class="select-modern"><option value="image">Image</option><option value="video">Video</option></select>
                <input id="ad-header" class="input-box" placeholder="Ad Header (e.g. SPECIAL OFFER)">
                <input id="ad-url" class="input-box" placeholder="Media Link (Picha au Video URL)">
                <input id="ad-duration" type="number" class="input-box" placeholder="Ad Duration (Seconds)">
                <label>Sponsor Links (Optional)</label>
                <input id="ad-wa" class="input-box" placeholder="WhatsApp Link">
                <input id="ad-tg" class="input-box" placeholder="Telegram Link">
                <button class="btn" onclick="saveAd()">ADD TO RANDOM POOL</button>
            </div>
            <div id="ads-list"></div>
        </div>

        <!-- 2. TOKEN FACTORY -->
        <div id="tokens" class="section">
            <h2>Premium Token Factory</h2>
            <div class="app-card">
                <input id="tk-value" type="number" class="input-box" placeholder="Value (e.g. 30)">
                <select id="tk-unit" class="select-modern">
                    <option value="seconds">Seconds</option>
                    <option value="minutes">Minutes</option>
                    <option value="hours" selected>Hours</option>
                    <option value="days">Days</option>
                </select>
                <input id="tk-count" type="number" class="input-box" placeholder="Number of Tokens">
                <button class="btn" onclick="generateTokens()">GENERATE TOKENS</button>
            </div>
            <div id="tk-list"></div>
        </div>

        <!-- 3. LIBRARY BUILDER -->
        <div id="library" class="section">
            <h2>Simulizi & Tech Updates Builder</h2>
            <div class="app-card">
                <select id="lib-cat" class="select-modern"><option value="simulizi">Simulizi (Stories)</option><option value="tech">Tech & Cyber Update</option></select>
                <input id="lib-title" class="input-box" placeholder="Book Title">
                <input id="lib-author" class="input-box" placeholder="Author Name">
                <div id="ep-container">
                    <div class="ep-row">
                        <input class="ep-title input-box" placeholder="Part 1 Title">
                        <textarea class="ep-content input-box" rows="4" placeholder="Content text..."></textarea>
                    </div>
                </div>
                <button class="btn btn-d" onclick="addEpField()">+ ADD NEXT PART</button>
                <button class="btn" style="margin-top:10px;" onclick="saveLibrary()">PUBLISH BOOK</button>
            </div>
        </div>

        <!-- 4. MOVIES & ADULT -->
        <div id="content" class="section">
            <h2>Manage Movies & Adult 18+</h2>
            <div class="app-card">
                <select id="ch-type" class="select-modern"><option value="channels">Live Channel</option><option value="movies">Regular Movie</option><option value="adultContent">Adult (18+)</option></select>
                <input id="ch-name" class="input-box" placeholder="Name/Title">
                <input id="ch-url" class="input-box" placeholder="Stream/Movie URL">
                <input id="ch-logo" class="input-box" placeholder="Poster/Logo URL">
                <select id="ch-player" class="select-modern"><option value="internal">Standard Player</option><option value="drm">DRM Pro Player</option></select>
                <input id="ch-license" class="input-box" placeholder="DRM License URL (Optional)">
                <input id="ch-token" class="input-box" placeholder="Bearer Token (Optional)">
                <button class="btn" onclick="saveContent()">SAVE CONTENT</button>
            </div>
            <div id="content-list"></div>
        </div>

        <!-- 5. CHAT SUPPORT -->
        <div id="chat" class="section">
            <h2>Support Chats & Groups</h2>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn" onclick="toggleChatView('private')">PRIVATE (BOT)</button>
                <button class="btn btn-d" onclick="toggleChatView('group')">GROUP CHAT</button>
            </div>
            <div id="chat-list" class="chat-list"></div>
            <!-- Reply Box -->
            <div id="reply-area" style="display:none;" class="app-card">
                <h4 id="reply-title">Reply to...</h4>
                <textarea id="reply-text" class="input-box" rows="3" placeholder="Write a reply..."></textarea>
                <button class="btn" onclick="sendReply()">SEND MESSAGE</button>
                <button class="btn btn-d" onclick="closeReply()">CLOSE</button>
            </div>
        </div>

        <!-- 6. USERS HWID -->
        <div id="users" class="section">
            <h2>Hardware Lock & Password Control</h2>
            <div id="user-list"></div>
        </div>

    </div>

    <div id="toast">Saved!</div>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDiexD5WK9GLhQldr6zNmC8iYWc4em5eyM",
            authDomain: "stany-min-tv.firebaseapp.com",
            databaseURL: "https://stany-min-tv-default-rtdb.firebaseio.com",
            projectId: "stany-min-tv",
            storageBucket: "stany-min-tv.firebasestorage.app",
            messagingSenderId: "16513327552",
            appId: "1:16513327552:web:b4b2247053f83aa0b8e825"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), auth = firebase.auth();

        auth.onAuthStateChanged(u => {
            if(u) { document.getElementById('authOverlay').style.display='none'; init(); }
            else { document.getElementById('authOverlay').style.display='flex'; }
        });

        function login() { auth.signInWithEmailAndPassword(document.getElementById('adminEmail').value, document.getElementById('adminPass').value).catch(e => alert(e.message)); }

        function init() {
            loadAds(); loadTokens(); loadUsers(); loadSupportList();
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- ADS ---
        function saveAd() {
            const ad = {
                type: document.getElementById('ad-type').value,
                header: document.getElementById('ad-header').value,
                url: document.getElementById('ad-url').value,
                duration: parseInt(document.getElementById('ad-duration').value),
                socialLinks: {
                    whatsapp: document.getElementById('ad-wa').value,
                    telegram: document.getElementById('ad-tg').value
                },
                timestamp: Date.now()
            };
            db.ref('ads').push(ad).then(() => { showToast("Ad Added!"); loadAds(); });
        }

        function loadAds() {
            db.ref('ads').on('value', snap => {
                const list = document.getElementById('ads-list'); list.innerHTML = '';
                snap.forEach(c => {
                    list.innerHTML += `<div class="item-row"><span>${c.val().header} (${c.val().type})</span><i class="fas fa-trash" style="color:red" onclick="del('ads/${c.key}')"></i></div>`;
                });
            });
        }

        // --- TOKENS ---
        function generateTokens() {
            const val = document.getElementById('tk-value').value;
            const unit = document.getElementById('tk-unit').value;
            const count = document.getElementById('tk-count').value;
            for(let i=0; i<count; i++) {
                const tk = 'TK-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                db.ref('tokens/' + tk).set({ status: 'unused', durationValue: val, durationUnit: unit });
            }
            showToast("Tokens Created!");
        }

        function loadTokens() {
            db.ref('tokens').limitToLast(15).on('value', snap => {
                const list = document.getElementById('tk-list'); list.innerHTML = '<h4>Latest Tokens</h4>';
                snap.forEach(c => {
                    const d = c.val();
                    list.innerHTML += `<div class="item-row"><span>${c.key} (${d.durationValue} ${d.durationUnit})</span><small style="color:${d.status === 'used' ? 'gray' : 'lime'}">${d.status.toUpperCase()}</small></div>`;
                });
            });
        }

        // --- LIBRARY ---
        function addEpField() {
            const container = document.getElementById('ep-container');
            const div = document.createElement('div');
            div.className = 'ep-row';
            div.innerHTML = `<input class="ep-title input-box" placeholder="Part Title"><textarea class="ep-content input-box" rows="4" placeholder="Content..."></textarea>`;
            container.appendChild(div);
        }

        function saveLibrary() {
            const eps = [];
            document.querySelectorAll('.ep-row').forEach(row => {
                eps.push({ partTitle: row.querySelector('.ep-title').value, content: row.querySelector('.ep-content').value });
            });
            const data = {
                category: document.getElementById('lib-cat').value,
                title: document.getElementById('lib-title').value,
                author: document.getElementById('lib-author').value,
                episodes: eps
            };
            db.ref('library').push(data).then(() => showToast("Book Published!"));
        }

        // --- CONTENT ---
        function saveContent() {
            const type = document.getElementById('ch-type').value;
            const data = {
                name: document.getElementById('ch-name').value,
                title: document.getElementById('ch-name').value,
                streamURL: document.getElementById('ch-url').value,
                movieURL: document.getElementById('ch-url').value,
                logo: document.getElementById('ch-logo').value,
                posterURL: document.getElementById('ch-logo').value,
                playerType: document.getElementById('ch-player').value,
                licenseURL: document.getElementById('ch-license').value,
                tokenID: document.getElementById('ch-token').value
            };
            db.ref(type).push(data).then(() => showToast("Content Saved!"));
        }

        // --- CHAT ---
        let selectedUserChat = null;
        function loadSupportList() {
            db.ref('supportChats').on('value', snap => {
                const list = document.getElementById('chat-list'); list.innerHTML = '';
                snap.forEach(userChat => {
                    const uid = userChat.key;
                    list.innerHTML += `<div class="chat-item" onclick="openReply('${uid}')"><span>Support Request from ${uid.substring(0,8)}...</span><i class="fas fa-chevron-right"></i></div>`;
                });
            });
        }

        function openReply(uid) {
            selectedUserChat = uid;
            document.getElementById('reply-to').innerText = "Reply to ID: " + uid;
            document.getElementById('reply-area').style.display = 'block';
        }

        function sendReply() {
            const text = document.getElementById('reply-text').value;
            if(!text) return;
            db.ref(`supportChats/${selectedUserChat}`).push({
                name: "Admin", uid: "admin", text: text, timestamp: Date.now(), isPremium: true
            }).then(() => { showToast("Reply Sent!"); closeReply(); });
        }

        // --- USERS ---
        function loadUsers() {
            db.ref('users').on('value', snap => {
                const list = document.getElementById('user-list'); list.innerHTML = '';
                snap.forEach(c => {
                    const u = c.val();
                    list.innerHTML += `<div class="item-row">
                        <div><b>${u.name}</b><br><small>${u.email}</small></div>
                        <div style="text-align:right">
                            <small style="display:block; color:yellow">Pass: ${u.secretPassword || 'N/A'}</small>
                            <button class="btn btn-d" style="font-size:10px; padding:5px 10px; margin-top:5px;" onclick="resetHWID('${c.key}')">RESET HWID</button>
                        </div>
                    </div>`;
                });
            });
        }

        function resetHWID(uid) { db.ref('users/'+uid).update({ hwid: "" }).then(() => showToast("HWID Reset!")); }

        // UTILS
        function closeReply() { document.getElementById('reply-area').style.display = 'none'; }
        function del(path) { if(confirm("Confirm Delete?")) db.ref(path).remove().then(() => showToast("Deleted!")); }
        function showToast(m) { const t = document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 2000); }
        function goHome() { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById('homeView').style.display='grid'; document.getElementById('backBtn').style.display='none'; }
    </script>
</body>
</html>
