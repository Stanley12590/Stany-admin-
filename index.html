<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STANY ADMIN | MASTER CONTROL</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #FF0000;
            --black: #000000;
            --white: #FFFFFF;
            --card: #111111;
            --border: #222222;
            --input: #080808;
        }

        * {
            box-sizing: border-box; margin: 0; padding: 0;
            font-family: 'Outfit', sans-serif; font-size: 12px; /* Compact UI */
        }

        body { background: var(--black); color: var(--white); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- Header --- */
        header {
            height: 60px; background: var(--card); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 15px;
        }
        .brand { font-size: 14px; font-weight: 800; color: var(--red); letter-spacing: 1px; }

        /* --- Sidebar & Main Content --- */
        #container { flex: 1; display: flex; overflow: hidden; }

        nav {
            width: 75px; background: var(--card); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; padding: 20px 0; gap: 25px;
        }
        .nav-link { color: #555; font-size: 20px; cursor: pointer; transition: 0.3s; position: relative; }
        .nav-link.active { color: var(--red); }
        .nav-link span { position: absolute; font-size: 8px; bottom: -12px; left: 50%; transform: translateX(-50%); font-weight: 700; }

        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .page-view { display: none; animation: slideUp 0.3s ease; }
        .active-view { display: block; }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- UI Components --- */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 12px; }
        .section-title { font-weight: 700; color: var(--red); margin-bottom: 12px; text-transform: uppercase; }
        
        .form-group { margin-bottom: 10px; }
        label { display: block; color: #888; margin-bottom: 4px; font-size: 10px; }
        .input-box { width: 100%; padding: 10px; background: var(--input); border: 1px solid var(--border); color: white; border-radius: 8px; }
        .input-box:focus { border-color: var(--red); outline: none; }

        .btn { padding: 10px 15px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }
        .btn-red { background: var(--red); color: white; justify-content: center; width: 100%; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: white; }

        /* --- Lists --- */
        .item-row { 
            background: var(--input); padding: 12px; border-radius: 10px; 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
            border: 1px solid var(--border);
        }
        .actions { display: flex; gap: 12px; }
        .actions i { cursor: pointer; font-size: 14px; }
        .fa-trash { color: #ff4444; }
        .fa-edit { color: #44ff44; }

        /* --- Modals --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000; display: none;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: var(--card); border: 1px solid var(--red);
            width: 100%; max-width: 450px; border-radius: 20px;
            padding: 20px; max-height: 90vh; overflow-y: auto;
        }

        .social-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 800; }
        .badge-premium { background: gold; color: black; }
        
    </style>
</head>
<body>

    <header>
        <div class="brand">STANY MIN ADMIN ULTIMATE</div>
        <div id="admin-status" style="color: #44ff44; font-size: 10px;"><i class="fas fa-circle"></i> Connected</div>
    </header>

    <div id="container">
        <nav>
            <div class="nav-link active" onclick="switchView('dash-v', this)"><i class="fas fa-home"></i><span>Dash</span></div>
            <div class="nav-link" onclick="switchView('ads-v', this)"><i class="fas fa-ad"></i><span>Ads</span></div>
            <div class="nav-link" onclick="switchView('media-v', this)"><i class="fas fa-play"></i><span>Media</span></div>
            <div class="nav-link" onclick="switchView('stories-v', this)"><i class="fas fa-book"></i><span>Simulizi</span></div>
            <div class="nav-link" onclick="switchView('users-v', this)"><i class="fas fa-users"></i><span>Users</span></div>
            <div class="nav-link" onclick="switchView('tokens-v', this)"><i class="fas fa-key"></i><span>Tokens</span></div>
        </nav>

        <main>
            <!-- DASHBOARD -->
            <div id="dash-v" class="page-view active-view">
                <div class="section-title">App Stats</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="card"><label>Total Users</label><h2 id="s-users">0</h2></div>
                    <div class="card"><label>Channels</label><h2 id="s-channels">0</h2></div>
                </div>
                <div class="card">
                    <label>Admin Quick Note</label>
                    <p style="opacity: 0.6;">Welcome back! Manage your app content efficiently here.</p>
                </div>
            </div>

            <!-- AD ENGINE -->
            <div id="ads-v" class="page-view">
                <div class="section-title">Ultimate Ad Engine</div>
                <button class="btn btn-red" onclick="openModal('ad-modal')">+ Create Ad Sponsor</button>
                <div id="ads-list" style="margin-top: 15px;"></div>
            </div>

            <!-- MEDIA (Channels & Movies) -->
            <div id="media-v" class="page-view">
                <div class="section-title">Media Management</div>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-red" onclick="openModal('chan-modal')" style="flex:1;">+ Channel</button>
                    <button class="btn btn-outline" onclick="openModal('movie-modal')" style="flex:1;">+ Movie</button>
                </div>
                <div class="card"><label>Live Channels</label><div id="chan-list"></div></div>
                <div class="card"><label>Movies</label><div id="movie-list"></div></div>
            </div>

            <!-- STORIES -->
            <div id="stories-v" class="page-view">
                <div class="section-title">Simulizi Hub</div>
                <button class="btn btn-red" onclick="openModal('story-modal')">+ Add New Hadithi</button>
                <div id="story-list" style="margin-top: 15px;"></div>
            </div>

            <!-- USERS -->
            <div id="users-v" class="page-view">
                <div class="section-title">Security & Users</div>
                <input type="text" class="input-box" placeholder="Search by email..." onkeyup="searchUsers(this.value)">
                <div id="user-list" style="margin-top: 15px;"></div>
            </div>

            <!-- TOKENS -->
            <div id="tokens-v" class="page-view">
                <div class="section-title">Token Generator</div>
                <div class="card">
                    <div class="form-group">
                        <label>Duration</label>
                        <div style="display:flex; gap:5px;">
                            <input type="number" id="t-val" class="input-box" value="1">
                            <select id="t-unit" class="input-box">
                                <option value="seconds">Seconds</option>
                                <option value="minutes">Minutes</option>
                                <option value="hours">Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-red" onclick="genToken()">Generate Token</button>
                </div>
                <div id="token-list"></div>
            </div>
        </main>
    </div>

    <!-- --- MODALS --- -->

    <!-- AD MODAL -->
    <div id="ad-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Manage Ad Sponsor</h3>
            <input type="hidden" id="ad-edit-id">
            <div class="form-group"><label>Sponsor Name</label><input id="ad-name" class="input-box"></div>
            <div class="form-group"><label>Ad Image/Video URL</label><input id="ad-media" class="input-box"></div>
            <div class="form-group"><label>Top Marquee (Moving text)</label><input id="ad-m-top" class="input-box"></div>
            <div class="form-group"><label>Bottom Marquee</label><input id="ad-m-bottom" class="input-box"></div>
            <div class="form-group">
                <label>Social Hub Icons (Icon | Link)</label>
                <div id="soc-hub-box">
                    <div class="social-row"><input class="input-box s-ico" placeholder="fa-brands fa-whatsapp" style="width:40%"><input class="input-box s-url" placeholder="URL" style="width:60%"></div>
                </div>
                <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="addSocRow()">+ Add Icon</button>
            </div>
            <button class="btn btn-red" onclick="saveAd()">SAVE AD</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeAllModals()">CANCEL</button>
        </div>
    </div>

    <!-- CHANNEL MODAL -->
    <div id="chan-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Channel / DRM Config</h3>
            <input type="hidden" id="ch-edit-id">
            <div class="form-group"><label>Name</label><input id="ch-name" class="input-box"></div>
            <div class="form-group"><label>Stream URL</label><input id="ch-url" class="input-box"></div>
            <div class="form-group"><label>Logo URL</label><input id="ch-logo" class="input-box"></div>
            <div style="border: 1px solid #333; padding: 10px; border-radius: 10px; margin: 10px 0;">
                <label style="color:var(--red)">DRM SYSTEM (OPTIONAL)</label>
                <div class="form-group"><label>License URL</label><input id="ch-lic" class="input-box"></div>
                <div class="form-group"><label>Bearer Token ID</label><input id="ch-token" class="input-box"></div>
            </div>
            <button class="btn btn-red" onclick="saveChannel()">SAVE CHANNEL</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeAllModals()">CANCEL</button>
        </div>
    </div>

    <!-- STORY MODAL -->
    <div id="story-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">New Story</h3>
            <input type="hidden" id="st-edit-id">
            <div class="form-group"><label>Title</label><input id="st-title" class="input-box"></div>
            <div class="form-group"><label>Author</label><input id="st-author" class="input-box"></div>
            <div class="form-group"><label>Genre</label><input id="st-genre" class="input-box"></div>
            <div class="form-group"><label>Cover URL</label><input id="st-cover" class="input-box"></div>
            <button class="btn btn-red" onclick="saveStory()">SAVE HADITHI</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeAllModals()">CANCEL</button>
        </div>
    </div>

    <!-- EPISODE MODAL -->
    <div id="ep-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Add Part / Episode</h3>
            <input type="hidden" id="ep-story-id">
            <div class="form-group"><label>Episode Title (e.g Part 1)</label><input id="ep-title" class="input-box"></div>
            <div class="form-group"><label>Content</label><textarea id="ep-body" class="input-box" style="height:150px"></textarea></div>
            <button class="btn btn-red" onclick="saveEpisode()">SAVE PART</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeAllModals()">CANCEL</button>
        </div>
    </div>

    <script>
        // --- STANY MIN FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDiexD5WK9GLhQldr6zNmC8iYWc4em5eyM",
            authDomain: "stany-min-tv.firebaseapp.com",
            databaseURL: "https://stany-min-tv-default-rtdb.firebaseio.com",
            projectId: "stany-min-tv",
            storageBucket: "stany-min-tv.firebasestorage.app",
            messagingSenderId: "16513327552",
            appId: "1:16513327552:web:b4b2247053f83aa0b8e825",
            measurementId: "G-JM25LJXL5C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // Navigation
        function switchView(id, el) {
            document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            el.classList.add('active');
            
            if(id === 'dash-v') loadDash();
            if(id === 'ads-v') loadAds();
            if(id === 'media-v') { loadChannels(); loadMovies(); }
            if(id === 'stories-v') loadStories();
            if(id === 'users-v') loadUsers();
            if(id === 'tokens-v') loadTokens();
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeAllModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

        // --- DASHBOARD ---
        function loadDash() {
            db.ref('users').on('value', s => document.getElementById('s-users').innerText = s.numChildren());
            db.ref('channels').on('value', s => document.getElementById('s-channels').innerText = s.numChildren());
        }

        // --- ADS ENGINE ---
        function addSocRow() {
            const div = document.createElement('div'); div.className = 'social-row';
            div.innerHTML = `<input class="input-box s-ico" placeholder="Icon Class" style="width:40%"><input class="input-box s-url" placeholder="URL" style="width:60%">`;
            document.getElementById('soc-hub-box').appendChild(div);
        }

        function saveAd() {
            const socialHub = [];
            document.querySelectorAll('.social-row').forEach(row => {
                const icon = row.querySelector('.s-ico').value;
                const url = row.querySelector('.s-url').value;
                if(icon && url) socialHub.push({ icon, url });
            });

            const data = {
                name: document.getElementById('ad-name').value,
                media: document.getElementById('ad-media').value,
                mTop: document.getElementById('ad-m-top').value,
                mBottom: document.getElementById('ad-m-bottom').value,
                socialHub: socialHub
            };
            db.ref('ads/list').push(data).then(() => { closeAllModals(); });
        }

        function loadAds() {
            db.ref('ads/list').on('value', s => {
                const list = document.getElementById('ads-list'); list.innerHTML = '';
                s.forEach(child => {
                    const ad = child.val();
                    list.innerHTML += `<div class="item-row"><span>${ad.name}</span><i class="fas fa-trash" onclick="deleteData('ads/list/${child.key}')"></i></div>`;
                });
            });
        }

        // --- MEDIA ---
        function saveChannel() {
            const data = {
                name: document.getElementById('ch-name').value,
                url: document.getElementById('ch-url').value,
                logo: document.getElementById('ch-logo').value,
                licUrl: document.getElementById('ch-lic').value,
                token: document.getElementById('ch-token').value
            };
            db.ref('channels').push(data).then(() => closeAllModals());
        }

        function loadChannels() {
            db.ref('channels').on('value', s => {
                const l = document.getElementById('chan-list'); l.innerHTML = '';
                s.forEach(child => {
                    l.innerHTML += `<div class="item-row"><span>${child.val().name}</span><i class="fas fa-trash" onclick="deleteData('channels/${child.key}')"></i></div>`;
                });
            });
        }

        // --- STORIES ---
        function saveStory() {
            const data = {
                title: document.getElementById('st-title').value,
                author: document.getElementById('st-author').value,
                genre: document.getElementById('st-genre').value,
                cover: document.getElementById('st-cover').value
            };
            db.ref('simulizi').push(data).then(() => closeAllModals());
        }

        function loadStories() {
            db.ref('simulizi').on('value', s => {
                const list = document.getElementById('story-list'); list.innerHTML = '';
                s.forEach(child => {
                    const st = child.val();
                    list.innerHTML += `
                        <div class="card">
                            <div style="display:flex; justify-content:space-between;">
                                <b>${st.title}</b>
                                <i class="fas fa-plus-circle" onclick="openEpModal('${child.key}')"></i>
                            </div>
                            <div id="ep-list-${child.key}" style="margin-top:10px;"></div>
                            <i class="fas fa-trash" style="margin-top:10px;" onclick="deleteData('simulizi/${child.key}')"></i>
                        </div>`;
                    loadEpisodes(child.key);
                });
            });
        }

        function openEpModal(id) { document.getElementById('ep-story-id').value = id; openModal('ep-modal'); }

        function saveEpisode() {
            const sid = document.getElementById('ep-story-id').value;
            const data = { title: document.getElementById('ep-title').value, body: document.getElementById('ep-body').value };
            db.ref(`simulizi/${sid}/parts`).push(data).then(() => closeAllModals());
        }

        function loadEpisodes(sid) {
            db.ref(`simulizi/${sid}/parts`).on('value', s => {
                const el = document.getElementById('ep-list-'+sid); el.innerHTML = '';
                s.forEach(child => {
                    el.innerHTML += `<div style="opacity:0.6; margin-bottom:4px;">${child.val().title} <i class="fas fa-times" onclick="deleteData('simulizi/${sid}/parts/${child.key}')"></i></div>`;
                });
            });
        }

        // --- USERS & HWID ---
        function loadUsers() {
            db.ref('users').on('value', s => {
                const list = document.getElementById('user-list'); list.innerHTML = '';
                s.forEach(child => {
                    const u = child.val();
                    list.innerHTML += `
                        <div class="card">
                            <b>${u.email}</b><br>
                            <span style="font-size:10px; color:#888;">HWID: ${u.hwid || 'None'}</span><br>
                            <div style="margin-top:10px; display:flex; gap:10px;">
                                <button class="btn btn-outline btn-sm" onclick="resetHWID('${child.key}')">Reset Device</button>
                                <button class="btn btn-outline btn-sm" onclick="alert('Password: ${u.password || 'Unknown'}')">View Pass</button>
                                <button class="btn btn-outline btn-sm" style="color:red" onclick="deleteData('users/${child.key}')">Delete</button>
                            </div>
                        </div>`;
                });
            });
        }

        function resetHWID(uid) { db.ref(`users/${uid}/hwid`).remove().then(() => alert("Device Lock Removed!")); }

        // --- TOKENS ---
        function genToken() {
            const val = document.getElementById('t-val').value;
            const unit = document.getElementById('t-unit').value;
            const token = Math.random().toString(36).substr(2, 8).toUpperCase();
            
            let ms = 0;
            if(unit==='seconds') ms = val * 1000;
            if(unit==='minutes') ms = val * 60000;
            if(unit==='hours') ms = val * 3600000;
            if(unit==='days') ms = val * 86400000;

            db.ref('tokens/'+token).set({ token, duration: ms, status: 'unused' })
            .then(() => alert("Token Created: " + token));
        }

        function loadTokens() {
            db.ref('tokens').on('value', s => {
                const list = document.getElementById('token-list'); list.innerHTML = '';
                s.forEach(child => {
                    const t = child.val();
                    list.innerHTML += `<div class="item-row"><span>${t.token}</span><i class="fas fa-trash" onclick="deleteData('tokens/${child.key}')"></i></div>`;
                });
            });
        }

        // Utils
        function deleteData(path) { if(confirm("Delete item forever?")) db.ref(path).remove(); }

        // Auth Protection
        auth.onAuthStateChanged(user => {
            if(!user) {
                const e = prompt("Admin Email:");
                const p = prompt("Password:");
                auth.signInWithEmailAndPassword(e, p).catch(() => location.reload());
            }
        });

    </script>
</body>
</html>
