<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STANY MIN ADMIN | SUPREME CONTROL</title>
    
    <!-- Professional Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #FF0000;
            --black: #000000;
            --white: #FFFFFF;
            --card: #121212;
            --border: #262626;
            --input: #080808;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Outfit', sans-serif; font-size: 12px; }
        body { background: var(--black); color: var(--white); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        header { height: 55px; background: var(--card); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; flex-shrink: 0; }
        .brand { font-size: 14px; font-weight: 800; color: var(--red); letter-spacing: 1.5px; }

        #container { flex: 1; display: flex; overflow: hidden; }

        /* --- Sidebar Navigation --- */
        nav { width: 75px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 15px; overflow-y: auto; }
        .nav-link { color: #555; font-size: 18px; cursor: pointer; transition: 0.3s; text-align: center; width: 100%; padding: 5px 0; }
        .nav-link.active { color: var(--red); border-right: 3px solid var(--red); }
        .nav-link span { display: block; font-size: 7px; font-weight: 800; margin-top: 3px; text-transform: uppercase; }

        /* --- Main Area --- */
        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .page-view { display: none; }
        .active-view { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(15px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- UI Elements --- */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 12px; position: relative; }
        .section-title { font-weight: 700; color: var(--red); margin-bottom: 12px; text-transform: uppercase; border-left: 3px solid var(--red); padding-left: 10px; }
        
        label { display: block; color: #888; margin-bottom: 5px; font-size: 10px; }
        .input-box { width: 100%; padding: 12px; background: var(--input); border: 1px solid var(--border); color: white; border-radius: 10px; margin-bottom: 10px; }
        .input-box:focus { border-color: var(--red); outline: none; }

        .btn { padding: 12px 15px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; justify-content: center; }
        .btn-red { background: var(--red); color: white; width: 100%; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: white; }

        /* --- List Elements --- */
        .item-row { background: var(--input); padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border: 1px solid var(--border); }
        .item-info { flex: 1; margin-right: 15px; }
        .item-info b { font-size: 13px; color: var(--white); display: block; }
        .item-info small { color: #777; font-size: 10px; }
        .actions { display: flex; gap: 15px; }
        .actions i { cursor: pointer; font-size: 15px; }
        .fa-trash { color: #ff4444; }
        .fa-edit { color: #44ff44; }

        /* --- Token Logic --- */
        .tok-card { border-left: 5px solid var(--red); }
        .tok-used { border-left-color: #333; opacity: 0.6; }

        /* --- Modals --- */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--red); width: 100%; max-width: 450px; border-radius: 25px; padding: 25px; max-height: 90vh; overflow-y: auto; }
        
        .social-entry { display: flex; gap: 5px; margin-bottom: 8px; align-items: center; background: #000; padding: 8px; border-radius: 10px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header>
        <div class="brand">STANY MIN BOSS ADMIN</div>
        <div id="conn-info" style="font-size: 9px; color: #44ff44;"><i class="fas fa-circle"></i> SYSTEM SYNCED</div>
    </header>

    <div id="container">
        <!-- Navigation Hub -->
        <nav>
            <div class="nav-link active" onclick="switchTab('dash', this)"><i class="fas fa-chart-pie"></i><span>Dash</span></div>
            <div class="nav-link" onclick="switchTab('tokens', this)"><i class="fas fa-key"></i><span>Tokens</span></div>
            <div class="nav-link" onclick="switchTab('ads', this)"><i class="fas fa-ad"></i><span>Ads Hub</span></div>
            <div class="nav-link" onclick="switchTab('media', this)"><i class="fas fa-play-circle"></i><span>Content</span></div>
            <div class="nav-link" onclick="switchTab('slider', this)"><i class="fas fa-images"></i><span>Sliders</span></div>
            <div class="nav-link" onclick="switchTab('stories', this)"><i class="fas fa-book"></i><span>Simulizi</span></div>
            <div class="nav-link" onclick="switchTab('posts', this)"><i class="fas fa-rss"></i><span>Updates</span></div>
            <div class="nav-link" onclick="switchTab('users', this)"><i class="fas fa-users-cog"></i><span>Users</span></div>
        </nav>

        <main>
            <!-- 1. DASHBOARD -->
            <div id="dash" class="page-view active-view">
                <div class="section-title">Statistics</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="card"><label>Total Users</label><h2 id="st-users">0</h2></div>
                    <div class="card"><label>Live Channels</label><h2 id="st-channels">0</h2></div>
                    <div class="card"><label>Used Tokens</label><h2 id="st-tokens">0</h2></div>
                    <div class="card"><label>Stories</label><h2 id="st-stories">0</h2></div>
                </div>
            </div>

            <!-- 2. TOKEN ENGINE -->
            <div id="tokens" class="page-view">
                <div class="section-title">Advanced Token Generator</div>
                <div class="card">
                    <label>Duration Value</label>
                    <input type="number" id="t-val" class="input-box" value="30">
                    <label>Duration Unit</label>
                    <select id="t-unit" class="input-box">
                        <option value="seconds">Seconds</option>
                        <option value="minutes">Minutes</option>
                        <option value="hours">Hours</option>
                        <option value="days" selected>Days</option>
                        <option value="weeks">Weeks</option>
                        <option value="months">Months (30D)</option>
                    </select>
                    <button class="btn btn-red" onclick="generateToken()">GENERATE TOKEN</button>
                </div>
                <div id="token-list"></div>
            </div>

            <!-- 3. ADS HUB -->
            <div id="ads" class="page-view">
                <div class="section-title">Ultimate Ads Configuration</div>
                <button class="btn btn-red" onclick="openAdForm()">+ Configure Ad Sponsor</button>
                <div id="ads-list" style="margin-top: 15px;"></div>
            </div>

            <!-- 4. MEDIA CRUD -->
            <div id="media" class="page-view">
                <div class="section-title">Channels & Cinema</div>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button class="btn btn-red btn-sm" onclick="openMediaForm('channels')">+ Channel</button>
                    <button class="btn btn-outline btn-sm" onclick="openMediaForm('movies')">+ Movie</button>
                    <button class="btn btn-outline btn-sm" onclick="openMediaForm('adult')">+ Adult 18+</button>
                </div>
                <div class="card"><label>Channels</label><div id="list-channels"></div></div>
                <div class="card"><label>Cinema Library</label><div id="list-movies"></div></div>
                <div class="card"><label>Adult (18+)</label><div id="list-adult"></div></div>
            </div>

            <!-- 5. SLIDER CRUD -->
            <div id="slider" class="page-view">
                <div class="section-title">Section Carousels</div>
                <button class="btn btn-red" onclick="openSliderForm()">+ Add New Carousel</button>
                <div id="slider-list" style="margin-top: 15px;"></div>
            </div>

            <!-- 6. STORIES CRUD -->
            <div id="stories" class="page-view">
                <div class="section-title">Simulizi Hub</div>
                <button class="btn btn-red" onclick="openStoryForm()">+ Create Story Profile</button>
                <div id="story-list" style="margin-top: 15px;"></div>
            </div>

            <!-- 7. UPDATES CRUD -->
            <div id="posts" class="page-view">
                <div class="section-title">Tech & Betting Updates</div>
                <button class="btn btn-red" onclick="openPostForm()">+ Add New update</button>
                <div id="post-list" style="margin-top: 15px;"></div>
            </div>

            <!-- 8. USERS CONTROL -->
            <div id="users" class="page-view">
                <div class="section-title">User Security & HWID</div>
                <input type="text" class="input-box" placeholder="Search user email..." onkeyup="searchUser(this.value)">
                <div id="user-list"></div>
            </div>
        </main>
    </div>

    <!-- --- MASTER MODALS --- -->

    <!-- Ad Config Modal -->
    <div id="ad-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Ad Sponsor Setup</h3>
            <label>Sponsor Name</label><input id="ad-name" class="input-box">
            <label>Ad Media URL (Image/Video)</label><input id="ad-media" class="input-box">
            <label>Marquee Top Text</label><input id="ad-m-top" class="input-box">
            <label>Marquee Bottom Text</label><input id="ad-m-bottom" class="input-box">
            <div id="soc-hub-box">
                <label>Social Icons (fa-brands fa-whatsapp | URL)</label>
            </div>
            <button class="btn btn-outline btn-sm" style="width:100%; margin-bottom:15px;" onclick="addSocialRow()">+ Add Icon Pair</button>
            <button class="btn btn-red" onclick="saveAdHub()">SAVE AD HUB</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeModal()">CANCEL</button>
        </div>
    </div>

    <!-- Media Modal -->
    <div id="media-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title" id="m-form-title">Content Details</h3>
            <input type="hidden" id="m-path"><input type="hidden" id="m-id">
            <label>Title</label><input id="m-title" class="input-box">
            <label>Stream / Video URL</label><input id="m-url" class="input-box">
            <label>Poster / Logo URL</label><input id="m-logo" class="input-box">
            <div id="drm-box" class="hidden" style="border: 1px solid #333; padding: 10px; border-radius: 12px; margin-bottom: 10px;">
                <label style="color:var(--red)">DRM SECURITY</label>
                <input id="m-lic" class="input-box" placeholder="License URL">
                <input id="m-token" class="input-box" placeholder="Bearer Token">
            </div>
            <button class="btn btn-red" onclick="saveMedia()">SAVE CONTENT</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeModal()">CANCEL</button>
        </div>
    </div>

    <!-- Slider Modal -->
    <div id="slider-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Carousel Image</h3>
            <input type="hidden" id="sl-id">
            <label>Target Page</label>
            <select id="sl-section" class="input-box">
                <option value="live">Live Channels Page</option>
                <option value="movie">Movies Page</option>
                <option value="adult">Adult 18+ Page</option>
            </select>
            <label>Image URL</label><input id="sl-img" class="input-box">
            <label>Slide Title</label><input id="sl-title" class="input-box">
            <button class="btn btn-red" onclick="saveSlider()">SAVE SLIDER</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeModal()">CANCEL</button>
        </div>
    </div>

    <!-- Episode Modal -->
    <div id="ep-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Add / Edit Episode</h3>
            <input type="hidden" id="ep-sid"><input type="hidden" id="ep-id">
            <label>Part Title (e.g Part 1)</label><input id="ep-title" class="input-box">
            <label>Maandishi (Story Body)</label><textarea id="ep-body" class="input-box" style="height:200px"></textarea>
            <button class="btn btn-red" onclick="saveEpisode()">SAVE PART</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeModal()">CANCEL</button>
        </div>
    </div>

    <!-- Post Modal -->
    <div id="post-modal" class="modal">
        <div class="modal-content">
            <h3 class="section-title">Manage Post</h3>
            <input type="hidden" id="p-id">
            <label>Category</label>
            <select id="p-cat" class="input-box"><option value="tech">Tech & Cybersecurity</option><option value="betting">Betting Tips</option></select>
            <label>Title / Match</label><input id="p-title" class="input-box">
            <label>Content / Tip</label><textarea id="p-body" class="input-box" style="height:120px"></textarea>
            <button class="btn btn-red" onclick="savePost()">POST UPDATE</button>
            <button class="btn btn-outline" style="width:100%; margin-top:5px;" onclick="closeModal()">CANCEL</button>
        </div>
    </div>

    <script>
        // --- STANY MIN FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDiexD5WK9GLhQldr6zNmC8iYWc4em5eyM",
            authDomain: "stany-min-tv.firebaseapp.com",
            databaseURL: "https://stany-min-tv-default-rtdb.firebaseio.com",
            projectId: "stany-min-tv",
            storageBucket: "stany-min-tv.firebasestorage.app",
            messagingSenderId: "16513327552",
            appId: "1:16513327552:web:b4b2247053f83aa0b8e825",
            measurementId: "G-JM25LJXL5C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(), auth = firebase.auth();

        // --- NAVIGATION ---
        function switchTab(id, el) {
            document.querySelectorAll('.page-view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            if(el) el.classList.add('active');
            
            if(id === 'dash') loadDash();
            if(id === 'tokens') loadTokens();
            if(id === 'ads') loadAds();
            if(id === 'media') { loadList('channels', 'list-channels'); loadList('movies', 'list-movies'); loadList('adult', 'list-adult'); }
            if(id === 'slider') loadSliders();
            if(id === 'stories') loadStories();
            if(id === 'posts') loadPosts();
            if(id === 'users') loadUsers();
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal() { 
            document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); 
            document.querySelectorAll('.input-box').forEach(i => i.value = ''); 
            document.querySelectorAll('input[type="hidden"]').forEach(h => h.value = '');
            document.getElementById('soc-hub-box').innerHTML = '';
        }

        // --- TOKEN SYSTEM ---
        function generateToken() {
            const v = document.getElementById('t-val').value, u = document.getElementById('t-unit').value;
            const tok = "STANY-" + Math.random().toString(36).substr(2, 7).toUpperCase();
            let ms = 0;
            if(u==='seconds') ms=v*1000; if(u==='minutes') ms=v*60000; if(u==='hours') ms=v*3600000;
            if(u==='days') ms=v*86400000; if(u==='weeks') ms=v*604800000; if(u==='months') ms=v*2592000000;
            db.ref('tokens/'+tok).set({ token: tok, durationMs: ms, label: v+' '+u, status: 'unused', createdAt: Date.now() }).then(() => alert("Created!"));
        }

        function loadTokens() {
            db.ref('tokens').on('value', s => {
                const list = document.getElementById('token-list'); list.innerHTML = '';
                s.forEach(c => {
                    const t = c.val(); const used = t.status === 'used';
                    list.innerHTML += `<div class="item-row ${used?'tok-used':'tok-card'}">
                        <div class="item-info">
                            <b>${t.token} <i class="fas fa-copy" onclick="navigator.clipboard.writeText('${t.token}'); alert('Token Copied')"></i></b>
                            <small>Muda: ${t.label || '---'}</small>
                            ${used ? `<small style="color:#44ff44">User: ${t.usedByName} (${t.usedByEmail})</small>` : ''}
                        </div>
                        <i class="fas fa-trash" onclick="del('tokens/${c.key}')"></i>
                    </div>`;
                });
            });
        }

        // --- ADS HUB ---
        function addSocialRow(icon = '', url = '') {
            const div = document.createElement('div'); div.className = 'social-entry';
            div.innerHTML = `<input class="input-box s-ico" value="${icon}" placeholder="fa-brands fa-whatsapp"><input class="input-box s-url" value="${url}" placeholder="URL"><i class="fas fa-minus-circle" onclick="this.parentElement.remove()"></i>`;
            document.getElementById('soc-hub-box').appendChild(div);
        }
        function saveAdHub() {
            const soc = []; document.querySelectorAll('.social-entry').forEach(r => {
                const i = r.querySelector('.s-ico').value, u = r.querySelector('.s-url').value;
                if(i) soc.push({ icon: i, url: u });
            });
            db.ref('ads/config').set({ name: document.getElementById('ad-name').value, image: document.getElementById('ad-media').value, marqueeTop: document.getElementById('ad-m-top').value, marqueeBottom: document.getElementById('ad-m-bottom').value, social: soc }).then(() => { closeModal(); });
        }
        function loadAds() {
            db.ref('ads/config').on('value', s => {
                const l = document.getElementById('ads-list'); l.innerHTML = '';
                if(!s.exists()) return;
                l.innerHTML = `<div class="item-row"><b>Active Ad: ${s.val().name}</b><i class="fas fa-edit" onclick="editAd()"></i></div>`;
            });
        }
        function editAd() {
            db.ref('ads/config').once('value', s => {
                const v = s.val(); document.getElementById('ad-name').value = v.name; document.getElementById('ad-media').value = v.image;
                document.getElementById('ad-m-top').value = v.marqueeTop; document.getElementById('ad-m-bottom').value = v.marqueeBottom;
                if(v.social) v.social.forEach(row => addSocialRow(row.icon, row.url));
                openModal('ad-modal');
            });
        }

        // --- MEDIA CRUD ---
        function openMediaForm(path) { document.getElementById('m-path').value = path; document.getElementById('drm-box').className = path==='channels'?'':'hidden'; openModal('media-modal'); }
        function saveMedia() {
            const p = document.getElementById('m-path').value, id = document.getElementById('m-id').value;
            const data = { title: document.getElementById('m-title').value, url: document.getElementById('m-url').value, poster: document.getElementById('m-logo').value };
            if(p==='channels') { data.licUrl = document.getElementById('m-lic').value; data.token = document.getElementById('m-token').value; }
            const ref = id ? db.ref(p+'/'+id) : db.ref(p).push();
            ref.set(data).then(() => closeModal());
        }
        function loadList(path, elId) {
            db.ref(path).on('value', s => {
                const l = document.getElementById(elId); l.innerHTML = '';
                s.forEach(c => {
                    const v = c.val();
                    l.innerHTML += `<div class="item-row"><b>${v.title}</b><div class="actions"><i class="fas fa-edit" onclick="editMedia('${path}','${c.key}')"></i><i class="fas fa-trash" onclick="del('${path}/${c.key}')"></i></div></div>`;
                });
            });
        }
        function editMedia(p, id) {
            db.ref(p+'/'+id).once('value', s => {
                const v = s.val(); document.getElementById('m-id').value = id; document.getElementById('m-path').value = p;
                document.getElementById('m-title').value = v.title; document.getElementById('m-url').value = v.url; document.getElementById('m-logo').value = v.poster;
                if(p==='channels') { document.getElementById('m-lic').value = v.licUrl||''; document.getElementById('m-token').value = v.token||''; }
                openMediaForm(p);
            });
        }

        // --- SLIDER CRUD ---
        function openSliderForm() { openModal('slider-modal'); }
        function saveSlider() {
            const id = document.getElementById('sl-id').value, sec = document.getElementById('sl-section').value;
            const data = { title: document.getElementById('sl-title').value, poster: document.getElementById('sl-img').value, url: document.getElementById('sl-url').value || '', isSlider: true };
            const ref = id ? db.ref('carousels/'+sec+'/'+id) : db.ref('carousels/'+sec).push();
            ref.set(data).then(() => closeModal());
        }
        function loadSliders() {
            const l = document.getElementById('slider-list'); l.innerHTML = '';
            ['live', 'movie', 'adult'].forEach(sec => {
                db.ref('carousels/'+sec).on('value', s => {
                    s.forEach(c => l.innerHTML += `<div class="item-row"><b>${sec.toUpperCase()}: ${c.val().title}</b><i class="fas fa-trash" onclick="del('carousels/${sec}/${c.key}')"></i></div>`);
                });
            });
        }

        // --- STORIES ---
        function openStoryForm() { openMediaForm('simulizi'); }
        function loadStories() {
            db.ref('simulizi').on('value', s => {
                const l = document.getElementById('story-list'); l.innerHTML = '';
                s.forEach(c => {
                    const st = c.val();
                    l.innerHTML += `<div class="card"><div style="display:flex; justify-content:space-between"><b>${c.val().title}</b><button class="btn btn-outline btn-sm" onclick="openEpForm('${c.key}')">+ PART</button></div><div id="eps-${c.key}" style="margin-top:10px; opacity:0.6"></div><div class="actions" style="justify-content:flex-end; margin-top:10px;"><i class="fas fa-edit" onclick="editMedia('simulizi','${c.key}')"></i><i class="fas fa-trash" onclick="del('simulizi/${c.key}')"></i></div></div>`;
                    db.ref(`simulizi/${c.key}/parts`).on('value', ps => {
                        const box = document.getElementById('eps-'+c.key); if(!box) return; box.innerHTML = '';
                        ps.forEach(p => box.innerHTML += `<div style="font-size:10px">â€¢ ${p.val().title} <i class="fas fa-trash" style="color:red" onclick="del('simulizi/${c.key}/parts/${p.key}')"></i></div>`);
                    });
                });
            });
        }
        function openEpForm(sid) { document.getElementById('ep-sid').value = sid; openModal('ep-modal'); }
        function saveEpisode() {
            const sid = document.getElementById('ep-sid').value;
            db.ref(`simulizi/${sid}/parts`).push({ title: document.getElementById('ep-title').value, body: document.getElementById('ep-body').value }).then(() => closeModal());
        }

        // --- UPDATES ---
        function openPostForm() { openModal('post-modal'); }
        function savePost() {
            const id = document.getElementById('p-id').value;
            const ref = id ? db.ref('posts/'+id) : db.ref('posts').push();
            ref.set({ category: document.getElementById('p-cat').value, title: document.getElementById('p-title').value, body: document.getElementById('p-body').value, time: Date.now() }).then(() => closeModal());
        }
        function loadPosts() {
            db.ref('posts').on('value', s => {
                const l = document.getElementById('post-list'); l.innerHTML = '';
                s.forEach(c => {
                    const v = c.val();
                    l.innerHTML += `<div class="item-row"><b>[${v.category.toUpperCase()}] ${v.title}</b><div class="actions"><i class="fas fa-edit" onclick="editPost('${c.key}')"></i><i class="fas fa-trash" onclick="del('posts/${c.key}')"></i></div></div>`;
                });
            });
        }
        function editPost(id) { db.ref('posts/'+id).once('value', s => { const v = s.val(); document.getElementById('p-id').value = id; document.getElementById('p-cat').value = v.category; document.getElementById('p-title').value = v.title; document.getElementById('p-body').value = v.body; openModal('post-modal'); }); }

        // --- USERS ---
        function loadUsers() {
            db.ref('users').on('value', s => {
                const l = document.getElementById('user-list'); l.innerHTML = '';
                s.forEach(c => {
                    const u = c.val();
                    l.innerHTML += `<div class="item-row" style="flex-direction:column; align-items:flex-start;">
                        <b>${u.email}</b><small>HWID: ${u.hwid || '---'} | PASS: ${u.password || '---'}</small>
                        <div style="display:flex; gap:10px; margin-top:8px;">
                            <button class="btn btn-outline btn-sm" onclick="db.ref('users/${c.key}/hwid').remove(); alert('Unlocked')">Reset HWID</button>
                            <button class="btn btn-outline btn-sm" style="color:red" onclick="del('users/${c.key}')">Delete</button>
                        </div>
                    </div>`;
                });
            });
        }

        function loadDash() {
            db.ref('users').on('value', s => document.getElementById('st-users').innerText = s.numChildren());
            db.ref('channels').on('value', s => document.getElementById('st-channels').innerText = s.numChildren());
            db.ref('simulizi').on('value', s => document.getElementById('st-stories').innerText = s.numChildren());
            db.ref('tokens').on('value', s => { let c=0; s.forEach(x=>{ if(x.val().status==='used') c++; }); document.getElementById('st-tokens').innerText = c; });
        }
        function del(p) { if(confirm("Confirm Delete?")) db.ref(p).remove(); }
        
        auth.onAuthStateChanged(user => {
            if(!user) {
                const e = prompt("Admin Email:"), p = prompt("Password:");
                auth.signInWithEmailAndPassword(e, p).catch(() => location.reload());
            } else { switchTab('dash', null); }
        });
    </script>
</body>
</html>
